---
name: test-driven-development
description: t-wada流テスト駆動開発（TDD）を実行するスキル。Red-Green-Refactorサイクルを厳密に守り、毎ステップでテストを実行して確認する。言語非依存。ユーザーが「TDDで実装して」「TDDで開発して」「テスト駆動で」など明示的にTDDを要求した時に使用する。
---

# t-wada流テスト駆動開発（TDD）

## ワークフロー全体像

```
1. TODOリスト作成
2. TODOを1つ選ぶ
3. 選んだTODOに対してRed-Green-Refactorサイクルを回す
4. TODOリストを更新（完了マーク、新規TODO追加）
5. 全TODOが完了するまで2に戻る
```

## Step 0: テスト実行環境の確認

TDD開始前に必ず以下を確認する：

- プロジェクトで使用しているテストフレームワークとテスト実行コマンドを特定する
- テストが実行できることを確認する（既存テストがあれば走らせる）
- テスト実行コマンドが不明な場合はユーザーに聞く

## Step 1: TODOリスト作成

実装前にTODOリストを作成する。これがTDD全体のロードマップになる。

ルール：
- 実装したい機能を小さなタスクに分解する
- 各TODOは1つのテストケースに対応する粒度にする
- 簡単なものから難しいものへ並べる
- TODOリストをユーザーに提示し、合意を得る

例：
```
- [ ] 数値を文字列に変換する
- [ ] 3の倍数のときは"Fizz"を返す
- [ ] 5の倍数のときは"Buzz"を返す
- [ ] 15の倍数のときは"FizzBuzz"を返す
- [ ] 範囲外の入力（0以下）はエラーにする
```

## Step 2: Red-Green-Refactorサイクル

TODOリストから1つ選び、以下のサイクルを**厳密に**回す。

### 2a. Red: 失敗するテストを書く

- **テストを1つだけ書く**。複数同時に書かない
- テストはArrange-Act-Assertパターンで構造化する：
  - **Arrange**: テスト対象の準備
  - **Act**: テスト対象の実行
  - **Assert**: 結果の検証
- **テストを実行し、失敗することを確認する**
- 失敗メッセージが意図通りであることを確認する（コンパイルエラーではなくアサーション失敗であるべき）
- 失敗しない場合：テストが間違っているか、既に実装済み。テストを見直す

> **重要**: Redを確認せずにGreenに進むことは絶対にしない。失敗を確認することで「このテストは正しく検証できている」という信頼性を担保する。

### 2b. Green: 最小限の実装で成功させる

3つの戦略を状況に応じて使い分ける：

**仮実装（Fake It）**: まずハードコードで通す
- 最初のテストや、正しい実装が見えない時に使う
- 例：`return "1"` とハードコードして通す

**三角測量（Triangulation）**: テストを増やして一般化を強制する
- 仮実装の次のステップとして使う
- 2つ以上のテストケースがあると、ハードコードでは通せなくなり、一般化せざるを得ない

**明白な実装（Obvious Implementation）**: 正しい実装が明白な時はそのまま書く
- 実装が簡単で自信がある時のみ使う
- 迷ったら仮実装に戻る

ルール：
- **最小限のコードだけを書く**。テストを通すために必要ない変更はしない
- テストを実行し、**成功することを確認する**
- 既存のテストも全て通ることを確認する

### 2c. Refactor: テストを変えずにコードを改善する

- 重複の除去、命名の改善、構造の整理を行う
- **テストコードは変更しない**（テストのリファクタリングはプロダクションコードと別のステップで行う）
- リファクタリング後に**テストを実行し、全て成功することを確認する**
- リファクタリングするものがなければスキップしてよい

## Step 3: TODOリスト更新

サイクルが1周したら：
- 完了したTODOにチェックを入れる
- 作業中に気づいた新しいTODOがあれば追加する
- 次のTODOを選んでStep 2に戻る

## ベイビーステップの原則

全工程を通じて以下を守る：

- **一度に1つのテストだけ**を扱う
- **一度に1つの変更だけ**を行う
- 大きなジャンプを感じたら、もっと小さなステップに分解する
- テストもプロダクションコードも、小さな変更→実行確認を繰り返す
- 迷ったり不安になったら、より小さなステップに戻る

## 各ステップで必ずやること

| ステップ | テスト実行 | 期待結果 |
|----------|-----------|----------|
| Red      | 必須      | 失敗（アサーションエラー） |
| Green    | 必須      | 全テスト成功 |
| Refactor | 必須      | 全テスト成功 |

**テスト実行を省略することは絶対にしない。** これがTDDの根幹である。
